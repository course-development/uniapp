<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>8. 加入购物车 | uniapp</title>
    <meta name="description" content="uniapp文档">
    <link rel="stylesheet" href="/uniapp/assets/style.8e78fc31.css">
    <link rel="modulepreload" href="/uniapp/assets/plugin-vue_export-helper.abe1cdd2.js">
    <link rel="modulepreload" href="/uniapp/assets/Home.e0c1a336.js">
    <link rel="modulepreload" href="/uniapp/assets/AlgoliaSearchBox.5d3b5af3.js">
    <link rel="modulepreload" href="/uniapp/assets/uniapp_mds_8.add2cart.md.d48ac617.lean.js">
    <link rel="modulepreload" href="/uniapp/assets/app.eab2e4c9.js">
    
    <meta name="twitter:title" content="8. 加入购物车 | uniapp">
  <meta property="og:title" content="8. 加入购物车 | uniapp">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/uniapp/" aria-label="uniapp, back to home" data-v-675d8756 data-v-4a583abe><!----> uniapp</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/uniapp/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/uniapp/config/basics" data-v-b8818f8c>Config Reference <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/uniapp/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/uniapp/config/basics" data-v-b8818f8c>Config Reference <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/mds">uniapp</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/1.start.html">1.起步</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/2.tabbar.html">2.tabBar</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/3.home.html">3.首页</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/4.cate.html">4.分类</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/5.search.html">5.搜索</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/6.goodslist.html">6.商品列表</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/7.goodsdetail.html">7.商品详情</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/uniapp/uniapp/mds/8.add2cart.html">8.加入购物车</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-0-创建-cart-分支">8.0 创建 cart 分支</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-1-配置-vuex">8.1 配置 vuex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-2-创建购物车的-store-模块">8.2 创建购物车的 store 模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-3-在商品详情页中使用-store-中的数据">8.3 在商品详情页中使用 Store 中的数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-4-实现加入购物车的功能">8.4 实现加入购物车的功能</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-5-动态统计购物车中商品的总数量">8.5 动态统计购物车中商品的总数量</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-6-持久化存储购物车中的商品">8.6 持久化存储购物车中的商品</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-7-优化商品详情页的-total-侦听器">8.7 优化商品详情页的 total 侦听器</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-8-动态为-tabbar-页面设置数字徽标">8.8 动态为 tabBar 页面设置数字徽标</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_8-9-将设置-tabbar-徽标的代码抽离为-mixins">8.9 将设置 tabBar 徽标的代码抽离为 mixins</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/9.cart.html">9.购物车页面</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/10.settle.html">10.我的页面</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/uniapp/uniapp/mds/11.publish.html">11.发布</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="_8-加入购物车" tabindex="-1">8. 加入购物车 <a class="header-anchor" href="#_8-加入购物车" aria-hidden="true">#</a></h1><h2 id="_8-0-创建-cart-分支" tabindex="-1">8.0 创建 cart 分支 <a class="header-anchor" href="#_8-0-创建-cart-分支" aria-hidden="true">#</a></h2><p>运行如下的命令，基于 master 分支在本地创建 cart 子分支，用来开发购物车相关的功能：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">git</span> checkout -b cart
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_8-1-配置-vuex" tabindex="-1">8.1 配置 vuex <a class="header-anchor" href="#_8-1-配置-vuex" aria-hidden="true">#</a></h2><ol><li><p>在项目根目录中创建 <code>store</code> 文件夹，专门用来存放 vuex 相关的模块</p></li><li><p>在 <code>store</code> 目录上鼠标右键，选择 <code>新建 -&gt; js文件</code>，新建 <code>store.js</code> 文件：</p><p><img src="/uniapp/assets/8-1.4d07178c.png" alt=""></p></li><li><p>在 <code>store.js</code> 中按照如下 4 个步骤<strong>初始化 Store 的实例对象</strong>：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 1. 导入 Vue 和 Vuex</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token comment">// 2. 将 Vuex 安装为 Vue 的插件</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token comment">// 3. 创建 Store 的实例对象</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// TODO：挂载 store 模块</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 4. 向外共享 Store 的实例对象</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li><li><p>在 <code>main.js</code> 中导入 <code>store</code> 实例对象并挂载到 Vue 的实例上：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token comment">// 1. 导入 store 的实例对象</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./store/store.js&#39;</span>

<span class="token comment">// 省略其它代码...</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>App<span class="token punctuation">,</span>
  <span class="token comment">// 2. 将 store 挂载到 Vue 实例上</span>
  store<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ol><h2 id="_8-2-创建购物车的-store-模块" tabindex="-1">8.2 创建购物车的 store 模块 <a class="header-anchor" href="#_8-2-创建购物车的-store-模块" aria-hidden="true">#</a></h2><ol><li><p>在 <code>store</code> 目录上鼠标右键，选择 <code>新建 -&gt; js文件</code>，创建购物车的 store 模块，命名为 <code>cart.js</code>：</p><p><img src="/uniapp/assets/8-2.f5e1f770.png" alt=""></p></li><li><p>在 <code>cart.js</code> 中，初始化如下的 vuex 模块：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 为当前模块开启命名空间</span>
  <span class="token literal-property property">namespaced</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

  <span class="token comment">// 模块的 state 数据</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 购物车的数组，用来存储购物车中每个商品的信息对象</span>
    <span class="token comment">// 每个商品的信息对象，都包含如下 6 个属性：</span>
    <span class="token comment">// { goods_id, goods_name, goods_price, goods_count, goods_small_logo, goods_state }</span>
    <span class="token literal-property property">cart</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// 模块的 mutations 方法</span>
  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 模块的 getters 属性</span>
  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li><li><p>在 <code>store/store.js</code> 模块中，导入并挂载购物车的 vuex 模块，示例代码如下：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>
<span class="token comment">// 1. 导入购物车的 vuex 模块</span>
<span class="token keyword">import</span> moduleCart <span class="token keyword">from</span> <span class="token string">&#39;./cart.js&#39;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// TODO：挂载 store 模块</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2. 挂载购物车的 vuex 模块，模块内成员的访问路径被调整为 m_cart，例如：</span>
    <span class="token comment">//    购物车模块中 cart 数组的访问路径是 m_cart/cart</span>
    <span class="token literal-property property">m_cart</span><span class="token operator">:</span> moduleCart<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol><h2 id="_8-3-在商品详情页中使用-store-中的数据" tabindex="-1">8.3 在商品详情页中使用 Store 中的数据 <a class="header-anchor" href="#_8-3-在商品详情页中使用-store-中的数据" aria-hidden="true">#</a></h2><ol><li><p>在 <code>goods_detail.vue</code> 页面中，修改 <code>&lt;script&gt;&lt;/script&gt;</code> 标签中的代码如下：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token comment">// 从 vuex 中按需导出 mapState 辅助方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用 mapState 方法，把 m_cart 模块中的 cart 数组映射到当前页面中，作为计算属性来使用</span>
    <span class="token comment">// ...mapState(&#39;模块的名称&#39;, [&#39;要映射的数据名称1&#39;, &#39;要映射的数据名称2&#39;])</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">&#39;m_cart&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;cart&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 省略其它代码...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>注意：今后无论映射 mutations 方法，还是 getters 属性，还是 state 中的数据，都需要指定模块的名称，才能进行映射。</p></blockquote></li><li><p>在页面渲染时，可以直接使用映射过来的数据，例如：</p><div class="language-xml line-numbers-mode"><pre><code><span class="token comment">&lt;!-- 运费 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yf<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>快递：免运费 -- {{cart.length}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h2 id="_8-4-实现加入购物车的功能" tabindex="-1">8.4 实现加入购物车的功能 <a class="header-anchor" href="#_8-4-实现加入购物车的功能" aria-hidden="true">#</a></h2><ol><li><p>在 store 目录下的 <code>cart.js</code> 模块中，封装一个将商品信息加入购物车的 mutations 方法，命名为 <code>addToCart</code>。示例代码如下：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 为当前模块开启命名空间</span>
  <span class="token literal-property property">namespaced</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

  <span class="token comment">// 模块的 state 数据</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 购物车的数组，用来存储购物车中每个商品的信息对象</span>
    <span class="token comment">// 每个商品的信息对象，都包含如下 6 个属性：</span>
    <span class="token comment">// { goods_id, goods_name, goods_price, goods_count, goods_small_logo, goods_state }</span>
    <span class="token literal-property property">cart</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// 模块的 mutations 方法</span>
  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> goods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 根据提交的商品的Id，查询购物车中是否存在这件商品</span>
      <span class="token comment">// 如果不存在，则 findResult 为 undefined；否则，为查找到的商品信息对象</span>
      <span class="token keyword">const</span> findResult <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>goods_id <span class="token operator">===</span> goods<span class="token punctuation">.</span>goods_id<span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>findResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果购物车中没有这件商品，则直接 push</span>
        state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>goods<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果购物车中有这件商品，则只更新数量即可</span>
        findResult<span class="token punctuation">.</span>goods_count<span class="token operator">++</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 模块的 getters 属性</span>
  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li><li><p>在商品详情页面中，通过 <code>mapMutations</code> 这个辅助方法，把 vuex 中 <code>m_cart</code> 模块下的 <code>addToCart</code> 方法映射到当前页面：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token comment">// 按需导入 mapMutations 这个辅助方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把 m_cart 模块中的 addToCart 方法映射到当前页面使用</span>
    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">&#39;m_cart&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;addToCart&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li><li><p>为商品导航组件 <code>uni-goods-nav</code> 绑定 <code>@buttonClick=&quot;buttonClick&quot;</code> 事件处理函数：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 右侧按钮的点击事件处理函数</span>
<span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 1. 判断是否点击了 加入购物车 按钮</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>content<span class="token punctuation">.</span>text <span class="token operator">===</span> <span class="token string">&#39;加入购物车&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// 2. 组织一个商品的信息对象</span>
      <span class="token keyword">const</span> goods <span class="token operator">=</span> <span class="token punctuation">{</span>
         <span class="token literal-property property">goods_id</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods_info<span class="token punctuation">.</span>goods_id<span class="token punctuation">,</span>       <span class="token comment">// 商品的Id</span>
         <span class="token literal-property property">goods_name</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods_info<span class="token punctuation">.</span>goods_name<span class="token punctuation">,</span>   <span class="token comment">// 商品的名称</span>
         <span class="token literal-property property">goods_price</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods_info<span class="token punctuation">.</span>goods_price<span class="token punctuation">,</span> <span class="token comment">// 商品的价格</span>
         <span class="token literal-property property">goods_count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                           <span class="token comment">// 商品的数量</span>
         <span class="token literal-property property">goods_small_logo</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods_info<span class="token punctuation">.</span>goods_small_logo<span class="token punctuation">,</span> <span class="token comment">// 商品的图片</span>
         <span class="token literal-property property">goods_state</span><span class="token operator">:</span> <span class="token boolean">true</span>                         <span class="token comment">// 商品的勾选状态</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 3. 通过 this 调用映射过来的 addToCart 方法，把商品信息对象存储到购物车中</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addToCart</span><span class="token punctuation">(</span>goods<span class="token punctuation">)</span>

   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol><h2 id="_8-5-动态统计购物车中商品的总数量" tabindex="-1">8.5 动态统计购物车中商品的总数量 <a class="header-anchor" href="#_8-5-动态统计购物车中商品的总数量" aria-hidden="true">#</a></h2><ol><li><p>在 <code>cart.js</code> 模块中，在 <code>getters</code> 节点下定义一个 <code>total</code> 方法，用来统计购物车中商品的总数量：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 模块的 getters 属性</span>
<span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token comment">// 统计购物车中商品的总数量</span>
   <span class="token function">total</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token comment">// 循环统计商品的数量，累加到变量 c 中</span>
      state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">goods</span> <span class="token operator">=&gt;</span> c <span class="token operator">+=</span> goods<span class="token punctuation">.</span>goods_count<span class="token punctuation">)</span>
      <span class="token keyword">return</span> c
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li><p>在商品详情页面的 <code>script</code> 标签中，按需导入 <code>mapGetters</code> 方法并进行使用：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token comment">// 按需导入 mapGetters 这个辅助方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把 m_cart 模块中名称为 total 的 getter 映射到当前页面中使用</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">&#39;m_cart&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;total&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li><li><p>通过 <code>watch</code> 侦听器，监听计算属性 <code>total</code> 值的变化，从而<strong>动态为购物车按钮的徽标赋值</strong>：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 监听 total 值的变化，通过第一个形参得到变化后的新值</span>
    <span class="token function">total</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2. 通过数组的 find() 方法，找到购物车按钮的配置对象</span>
      <span class="token keyword">const</span> findResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>text <span class="token operator">===</span> <span class="token string">&#39;购物车&#39;</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>findResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 3. 动态为购物车按钮的 info 属性赋值</span>
        findResult<span class="token punctuation">.</span>info <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol><h2 id="_8-6-持久化存储购物车中的商品" tabindex="-1">8.6 持久化存储购物车中的商品 <a class="header-anchor" href="#_8-6-持久化存储购物车中的商品" aria-hidden="true">#</a></h2><ol><li><p>在 <code>cart.js</code> 模块中，声明一个叫做 <code>saveToStorage</code> 的 mutations 方法，此方法负责将购物车中的数据持久化存储到本地：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 将购物车中的数据持久化存储到本地</span>
<span class="token function">saveToStorage</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">&#39;cart&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>修改 <code>mutations</code> 节点中的 <code>addToCart</code> 方法，在处理完商品信息后，调用步骤 1 中定义的 <code>saveToStorage</code> 方法：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre><code><span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> goods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 根据提交的商品的Id，查询购物车中是否存在这件商品</span>
   <span class="token comment">// 如果不存在，则 findResult 为 undefined；否则，为查找到的商品信息对象</span>
   <span class="token keyword">const</span> findResult <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>goods_id <span class="token operator">===</span> goods<span class="token punctuation">.</span>goods_id<span class="token punctuation">)</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>findResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果购物车中没有这件商品，则直接 push</span>
      state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>goods<span class="token punctuation">)</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果购物车中有这件商品，则只更新数量即可</span>
      findResult<span class="token punctuation">.</span>goods_count<span class="token operator">++</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// 通过 commit 方法，调用 m_cart 命名空间下的 saveToStorage 方法</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;m_cart/saveToStorage&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li><li><p>修改 <code>cart.js</code> 模块中的 <code>state</code> 函数，读取本地存储的购物车数据，对 cart 数组进行初始化：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre><code><span class="token comment">// 模块的 state 数据</span>
<span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token comment">// 购物车的数组，用来存储购物车中每个商品的信息对象</span>
   <span class="token comment">// 每个商品的信息对象，都包含如下 6 个属性：</span>
   <span class="token comment">// { goods_id, goods_name, goods_price, goods_count, goods_small_logo, goods_state }</span>
   <span class="token literal-property property">cart</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">&#39;cart&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;[]&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol><h2 id="_8-7-优化商品详情页的-total-侦听器" tabindex="-1">8.7 优化商品详情页的 total 侦听器 <a class="header-anchor" href="#_8-7-优化商品详情页的-total-侦听器" aria-hidden="true">#</a></h2><ol><li><p>使用<strong>普通函数的形式</strong>定义的 watch 侦听器，<strong>在页面首次加载后不会被调用</strong>。因此导致了商品详情页在首次加载完毕之后，不会将商品的总数量显示到商品导航区域：</p><div class="language-js line-numbers-mode"><pre><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token comment">// 页面首次加载完毕后，不会调用这个侦听器</span>
   <span class="token function">total</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> findResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>text <span class="token operator">===</span> <span class="token string">&#39;购物车&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>findResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         findResult<span class="token punctuation">.</span>info <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li><li><p>为了防止这个上述问题，可以使用<strong>对象的形式</strong>来定义 watch 侦听器（详细文档请参考 Vue 官方的 <a href="https://cn.vuejs.org/v2/api/#watch" target="_blank" rel="noopener noreferrer">watch 侦听器</a>教程），示例代码如下：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token comment">// 定义 total 侦听器，指向一个配置对象</span>
   <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// handler 属性用来定义侦听器的 function 处理函数</span>
      <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> findResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>text <span class="token operator">===</span> <span class="token string">&#39;购物车&#39;</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>findResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            findResult<span class="token punctuation">.</span>info <span class="token operator">=</span> newVal
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// immediate 属性用来声明此侦听器，是否在页面初次加载完毕后立即调用</span>
      <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol><h2 id="_8-8-动态为-tabbar-页面设置数字徽标" tabindex="-1">8.8 动态为 tabBar 页面设置数字徽标 <a class="header-anchor" href="#_8-8-动态为-tabbar-页面设置数字徽标" aria-hidden="true">#</a></h2><blockquote><p>需求描述：从商品详情页面导航到购物车页面之后，需要为 tabBar 中的购物车动态设置数字徽标。</p></blockquote><ol><li><p>把 Store 中的 total 映射到 <code>cart.vue</code> 中使用：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token comment">// 按需导入 mapGetters 这个辅助方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将 m_cart 模块中的 total 映射为当前页面的计算属性</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">&#39;m_cart&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;total&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li><li><p>在页面刚显示出来的时候，立即调用 <code>setBadge</code> 方法，为 tabBar 设置数字徽标：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 在页面刚展示的时候，设置数字徽标</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setBadge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>在 <code>methods</code> 节点中，声明 <code>setBadge</code> 方法如下，通过 <code>uni.setTabBarBadge()</code> 为 tabBar 设置数字徽标：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token function">setBadge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调用 uni.setTabBarBadge() 方法，为购物车设置右上角的徽标</span>
      uni<span class="token punctuation">.</span><span class="token function">setTabBarBadge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 索引</span>
         <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">+</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// 注意：text 的值必须是字符串，不能是数字</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol><h2 id="_8-9-将设置-tabbar-徽标的代码抽离为-mixins" tabindex="-1">8.9 将设置 tabBar 徽标的代码抽离为 mixins <a class="header-anchor" href="#_8-9-将设置-tabbar-徽标的代码抽离为-mixins" aria-hidden="true">#</a></h2><blockquote><p>注意：除了要在 cart.vue 页面中设置购物车的数字徽标，还需要在其它 3 个 tabBar 页面中，为购物车设置数字徽标。</p></blockquote><blockquote><p>此时可以使用 Vue 提供的 <a href="https://cn.vuejs.org/v2/guide/mixins.html" target="_blank" rel="noopener noreferrer">mixins</a> 特性，提高代码的可维护性。</p></blockquote><ol><li><p>在项目根目录中新建 <code>mixins</code> 文件夹，并在 <code>mixins</code> 文件夹之下新建 <code>tabbar-badge.js</code> 文件，用来把设置 tabBar 徽标的代码封装为一个 mixin 文件：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token comment">// 导出一个 mixin 对象</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">&#39;m_cart&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;total&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在页面刚展示的时候，设置数字徽标</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setBadge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">setBadge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调用 uni.setTabBarBadge() 方法，为购物车设置右上角的徽标</span>
      uni<span class="token punctuation">.</span><span class="token function">setTabBarBadge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">+</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 注意：text 的值必须是字符串，不能是数字</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li><li><p>修改 <code>home.vue</code>，<code>cate.vue</code>，<code>cart.vue</code>，<code>my.vue</code> 这 4 个 tabBar 页面的源代码，分别导入 <code>@/mixins/tabbar-badge.js</code> 模块并进行使用：</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="token comment">// 导入自己封装的 mixin 模块</span>
<span class="token keyword">import</span> badgeMix <span class="token keyword">from</span> <span class="token string">&#39;@/mixins/tabbar-badge.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 将 badgeMix 混入到当前的页面中进行使用</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>badgeMix<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 省略其它代码...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>上次更新:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/uniapp/uniapp/mds/7.goodsdetail" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>7.商品详情</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/uniapp/uniapp/mds/9.cart" data-v-38ede35f><span class="text" data-v-38ede35f>9.购物车页面</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"c172618c\",\"uniapp_mds_1.start.md\":\"edcbb714\",\"uniapp_mds_10.settle.md\":\"2eca722e\",\"uniapp_mds_11.publish.md\":\"f9c9ea26\",\"uniapp_mds_2.tabbar.md\":\"7a94d57d\",\"uniapp_mds_3.home.md\":\"f3d22d82\",\"uniapp_mds_4.cate.md\":\"8046f855\",\"uniapp_mds_5.search.md\":\"9071b42b\",\"uniapp_mds_6.goodslist.md\":\"a59c6904\",\"uniapp_mds_7.goodsdetail.md\":\"3f23ae34\",\"uniapp_mds_8.add2cart.md\":\"d48ac617\",\"uniapp_mds_9.cart.md\":\"456de0e9\"}")</script>
    <script type="module" async src="/uniapp/assets/app.eab2e4c9.js"></script>
    
  </body>
</html>